<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="images/favicon.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flight Delay Compensation | Quaerens</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ✅ Add Alpine.js here -->
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .content-box {
      max-width: 600px;
      margin: 0 auto;
      padding: 2rem;
      background: #f9fafb;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    .goog-te-banner-frame.skiptranslate,
  .goog-logo-link,
  .goog-te-gadget {
    display: none !important;
  }
  body {
    top: 0px !important;
  }
    form label {
      display: block;
      margin-top: 1rem;
      font-weight: 600;
    }
    form input, form select {
      width: 100%;
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-top: 0.5rem;
    }
  </style>
  <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en',
        includedLanguages: 'en,es,fr,de,nl,it',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
      }, 'google_translate_element');
    }
  </script>
  <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
  <script>
    function setLanguage(lang) {
      var newLang = '/auto/' + lang;
      document.cookie = 'googtrans=' + newLang + '; path=/';
      document.cookie = 'googtrans=' + newLang + '; domain=' + window.location.hostname + '; path=/';
      location.reload();
    }
  </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  </head>

<body class="bg-gray-50 text-gray-800">
  <div id="google_translate_element" style="display: none;"></div>
  <!-- Header -->
  <header class="bg-white shadow">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <a href="/">
        <img src="images/quaerens-logo.png" alt="Quaerens Logo" class="h-20 w-auto">
      </a>
      <nav>
        <a href="/" class="text-gray-700 hover:text-blue-600 font-medium">More claims</a>
      </nav>
      
    </div>
  </header>

<!-- Hero Section -->
<section class="relative w-full overflow-hidden">
  <img src="images/hero-flight2.jpg" alt="Free Legal Help Banner"
       class="w-full h-auto object-cover object-center" loading="eager" fetchpriority="high" />
</section>

<div class="mt-10 bg-white border border-gray-200 rounded-xl p-6 shadow-md">

  <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 items-center text-center">

    <!-- News Item 1 -->
    <div>
      <img src="/images/logo-skynews.png" alt="Sky News" class="mx-auto h-10 mb-2">
      <p class="text-sm text-gray-700">“Finally, a flight claim service that’s 100% free.”</p>
    </div>

    <!-- News Item 2 -->
    <div>
      <img src="/images/logo-travelweekly.png" alt="Travel Weekly" class="mx-auto h-10 mb-2">
      <p class="text-sm text-gray-700">“No lawyers. No fees. Just fast, fair help for delayed flyers.”</p>
    </div>

    <!-- News Item 3 -->
    <div>
      <img src="/images/logo-euconsumerwatch.png" alt="EU Consumer Watch" class="mx-auto h-10 mb-2">
      <p class="text-sm text-gray-700">“EC261 letters in minutes – sent to the airline for you.”</p>
    </div>

  </div>
</div>

<!-- EC261 Claim Letter Generator Section (Improved for Mobile and Layout) -->
<section class="bg-blue-50 pt-0">
  <!-- Hero Image -->
  <div class="w-full flex justify-center items-center bg-white overflow-hidden px-2">
    <img
      src="images/hero-flight3.png"
      alt="Generate Your Free EC261 Claim Letter"
      class="w-full max-h-[600px] object-contain"
      loading="lazy"
    />
  </div>

  <!-- Heading and Subtext Below Hero -->
  <div class="max-w-3xl mx-auto px-4 pt-6 pb-10 text-center">
    <div class="bg-yellow-300 text-blue-900 px-6 py-6 rounded-xl shadow-lg border-2 border-yellow-500">
      <h2 class="text-3xl sm:text-4xl font-extrabold uppercase tracking-wide">
        Generate Your Free EC261 Claim Letter
      </h2>
      <p class="text-lg sm:text-xl font-semibold mt-2">
        No lawyers, no fees — just fill in your flight details!
      </p>
    </div>
  </div>
</section>

    <p class="text-gray-700 text-center mb-6">Fill in your flight and contact details to get a free compensation claim letter (PDF or email). No lawyer needed.</p>

    <form id="claim-letter-form" class="bg-white p-6 rounded shadow-md space-y-4">

      <div>
        <label class="font-semibold">Full Name</label>
        <input type="text" id="fullName" required class="w-full border p-2 rounded" />
      </div>
    
      <div>
        <label class="font-semibold">Flight Number</label>
        <input type="text" id="flightNumber" required class="w-full border p-2 rounded" />
      </div>
    
      <div>
        <label class="font-semibold">Booking Reference</label>
        <input type="text" id="bookingRef" class="w-full border p-2 rounded" required />
      </div>
    
      <div>
        <label class="font-semibold">Preferred Payment Method (e.g. IBAN, PayPal)</label>
        <input type="text" id="iban" class="w-full border p-2 rounded" required />
      </div>
    
      <div>
        <label class="font-semibold">Flight Date</label>
        <input type="date" id="flightDate" required class="w-full border p-2 rounded" />
      </div>
    
      <div>
        <label class="font-semibold">Departure Airport</label>
        <input type="text" id="depAirport" required class="w-full border p-2 rounded" />
      </div>
    
      <div>
        <label class="font-semibold">Arrival Airport</label>
        <input type="text" id="arrAirport" required class="w-full border p-2 rounded" />
      </div>
    
      <div>
        <label class="font-semibold">Airline</label>
        <input type="text" id="airline" list="airlines" required class="w-full border p-2 rounded" />
        <div id="airlineLogoPreview" class="mt-2"></div>
      </div>
    
      <div>
        <label class="font-semibold">Reason for Delay</label>
        <input type="text" id="reason" class="w-full border p-2 rounded" />
      </div>
    
      <div>
        <label class="font-semibold">Flight Distance</label>
        <select id="distance" required class="w-full border p-2 rounded">
          <option value="">Select distance</option>
          <option value="short">Under 1500 km</option>
          <option value="medium">1500–3500 km</option>
          <option value="long">Over 3500 km</option>
        </select>
      </div>
    
      <div>
        <label class="font-semibold">Delay Duration</label>
        <select id="delayDuration" required class="w-full border p-2 rounded">
          <option value="">Select duration</option>
          <option value="2">2 hours</option>
          <option value="3">3 hours</option>
          <option value="4">4+ hours</option>
        </select>
      </div>
    
      <div>
        <label class="font-semibold">Preferred Language</label>
        <select id="language" required class="w-full border p-2 rounded">
          <option value="en">English</option>
          <option value="es">Spanish</option>
          <option value="de">German</option>
          <option value="fr">French</option>
          <option value="nl">Dutch</option>
          <option value="it">Italian</option>
        </select>
      </div>
    
      <div>
        <label class="font-semibold">Email Address</label>
        <input type="email" id="email" required class="w-full border p-2 rounded" />
      </div>
    
      <div>
        <label class="font-semibold">Would you like us to handle it for you?</label>
        <select id="handleOption" class="w-full border p-2 rounded">
          <option value="pdf">No thanks – just give me the PDF letter</option>
          <option value="email">Email me the letter</option>
          <option value="quaerens">Let Quaerens handle the claim for me (no win, no fee)</option>
        </select>
      </div>
    
      <div>
        <label class="font-semibold">Would you like to donate?</label>
        <select id="donation" class="w-full border p-2 rounded">
          <option value="none">No donation</option>
          <option value="quaerens">Support Quaerens</option>
          <option value="charity">Donate to charity</option>
          <option value="split">Split between both</option>
        </select>
      </div>
    
      <div>
        <label class="font-semibold">Upload Boarding Pass or Document (optional)</label>
        <input type="file" id="fileUpload" class="w-full border p-2 rounded" />
      </div>
      
      <button type="submit" class="w-full bg-blue-600 text-white p-3 rounded font-semibold hover:bg-blue-700 transition">
        Generate My Claim Letter
      </button>
      
      </form> <!-- ✅ Close form here, only once -->
      
      <div id="claim-letter-result" class="hidden text-green-600 mt-4 font-semibold">
        ✅ Your letter is being prepared...
      </div>    
   
  </section>

<!-- Testimonials -->
<section class="relative py-16" style="background-image: url('images/airport-soft-bg.jpg'); background-size: cover; background-position: center;">
    <div class="bg-white bg-opacity-90 py-12">
      <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-2xl font-bold text-center mb-10">What Our Clients Say</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
  
          <div class="bg-gray-100 p-6 rounded shadow" data-aos="zoom-in">
            <p class="italic">“I can’t believe this was completely free. Got my €600 after a 4-hour delay!”</p>
            <p class="font-semibold mt-4">– James T.</p>
          </div>
  
          <div class="bg-gray-100 p-6 rounded shadow" data-aos="zoom-in" data-aos-delay="100">
            <p class="italic">“Thank you Quaerens! You made a complicated claim super simple — and didn’t charge me a thing.”</p>
            <p class="font-semibold mt-4">– Eleni K.</p>
          </div>
  
          <div class="bg-gray-100 p-6 rounded shadow" data-aos="zoom-in" data-aos-delay="200">
            <p class="italic">“Really impressed. Instant form, clear instructions, and no catch. Just honest help.”</p>
            <p class="font-semibold mt-4">– Daniel M.</p>
          </div>
  
        </div>
      </div>
    </div>
  </section>  

<!-- Footer -->
  <footer style="text-align: center; font-size: 0.85rem; color: #6b7280; padding: 2rem 1rem; max-width: 800px; margin: 0 auto;">
  © 2025 Quaerens Ltd. All rights reserved.<br />
  <a href="privacy.html" style="color: #2563eb; text-decoration: none; margin: 0 0.5rem;">Privacy Policy</a> |
  <a href="terms.html" style="color: #2563eb; text-decoration: none; margin: 0 0.5rem;">Terms of Use</a> |
  <a href="gdpr.html" style="color: #2563eb; text-decoration: none; margin: 0 0.5rem;">GDPR</a> |
  <a href="contact.html" style="color: #2563eb; text-decoration: none; margin: 0 0.5rem;">Contact Us</a>
</footer>

  <script>
    document.getElementById('compensation-form').addEventListener('submit', function (e) {
      e.preventDefault();

      const delay = parseInt(document.getElementById('delay').value);
      let compensation = 0;

      if (delay >= 4) {
        compensation = 600;
      } else if (delay >= 3) {
        compensation = 400;
      }

      const result = document.getElementById('compensation-result');
      if (compensation > 0) {
        result.innerHTML = `✅ You may be entitled to <strong>€${compensation}</strong> in compensation.<br>
          <a href="claim.html?type=flight-delay" style="color: white; background: #2563eb; padding: 0.6rem 1.2rem; border-radius: 6px; display: inline-block; margin-top: 1rem; text-decoration: none;">Start Your Claim</a>`;
      } else {
        result.innerHTML = `ℹ️ Unfortunately, delays under 3 hours don't qualify under EU261 rules.`;
      }
    });

    const airportList = [
      "Amsterdam Schiphol (AMS)", "Barcelona El Prat (BCN)", "Berlin Brandenburg (BER)", "Brussels Zaventem (BRU)",
      "Copenhagen (CPH)", "Dublin (DUB)", "Edinburgh (EDI)", "Frankfurt (FRA)", "Geneva (GVA)", "Lisbon (LIS)",
      "London Gatwick (LGW)", "London Heathrow (LHR)", "Madrid Barajas (MAD)", "Malaga (AGP)", "Manchester (MAN)",
      "Milan Malpensa (MXP)", "Munich (MUC)", "Nice Côte d'Azur (NCE)", "Oslo Gardermoen (OSL)", "Paris Charles de Gaulle (CDG)",
      "Paris Orly (ORY)", "Porto (OPO)", "Prague Vaclav Havel (PRG)", "Rome Fiumicino (FCO)", "Stockholm Arlanda (ARN)",
      "Vienna (VIE)", "Warsaw Chopin (WAW)", "Zagreb (ZAG)", "Zurich (ZRH)", "Athens (ATH)", "Palma de Mallorca (PMI)",
      "Ibiza (IBZ)", "Tenerife South (TFS)", "Gran Canaria (LPA)", "Rhodes (RHO)", "Corfu (CFU)", "Heraklion (HER)",
      "Larnaca (LCA)", "Paphos (PFO)", "Split (SPU)", "Dubrovnik (DBV)", "Reykjavik (KEF)"
    ];

    const datalist = document.getElementById('airports');
    airportList.forEach(name => {
      const option = document.createElement('option');
      option.value = name;
      datalist.appendChild(option);
    });
  </script>
<script type="text/javascript">
  var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
  (function(){
    var s1=document.createElement("script"),
        s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/68134ea200e88619103f49ca/1iq5mmahm';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
  })();
</script>
<button id="scrollTopBtn" class="hidden fixed bottom-6 right-6 z-50 p-3 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition">
  ↑
</button>
<script>
  const scrollBtn = document.getElementById("scrollTopBtn");
  window.addEventListener("scroll", () => {
    scrollBtn.classList.toggle("hidden", window.scrollY < 300);
  });
  scrollBtn.addEventListener("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>

<script type="module" src="firebase-setup.js"></script>

<script>
  const db = window.firestore;
  const storage = window.storage;
  const {
    collection,
    addDoc,
    serverTimestamp,
    ref,
    uploadBytes,
    getDownloadURL
  } = window.firebaseUtils;

  document.getElementById("claim-letter-form").addEventListener("submit", async function (e) {
    e.preventDefault();
    console.log("Form submitted"); // <--- for debugging
    // your code to extract values + call generatePDF()
  });

<script>
  const airlineEmails = {
  "Ryanair": "claims@ryanair.com",
  "easyJet": "customer.support@easyjet.com",
  "Lufthansa": "customer.relations@lufthansa.com",
  "Vueling": "atencion.clientes@vueling.com",
  "British Airways": "customer.relations@ba.com",
  "KLM": "mail@klm.nl",
  "Transavia": "servicecentre@transavia.com",
  "Air France": "mail.afklmplc@airfrance.fr",
  "Iberia": "clasica@iberia.es",
  "Jet2": "customer.service@jet2.com",
  "Wizz Air": "claim@wizzair.com",
  "TUI Airways": "aftertravel@tui.co.uk",
  "Norwegian": "complaints@norwegian.com",
  "Aer Lingus": "customerqueries@aerlingus.com",
  "Brussels Airlines": "claim@brusselsairlines.com",
  "Swiss International Air Lines": "contact@swiss.com",
  "Eurowings": "customercare@eurowings.com",
  "TAP Air Portugal": "customer@tap.pt",
  "Finnair": "feedback@finnair.com",
  "SAS Scandinavian Airlines": "customercare@sas.se",
  "Aegean Airlines": "customercare@aegeanair.com",
  "LOT Polish Airlines": "contact@lot.pl",
  "Air Malta": "customer.relations@airmalta.com",
  "Corendon Airlines": "info@corendon-airlines.com",
  "SunExpress": "customer.service@sunexpress.com",
  "Blue Air": "support@blueairweb.com",
  "Volotea": "support@volotea.com",
  "Lauda Europe": "assistance@laudamotion.com",
  "Widerøe": "info@wideroe.no",
  "Croatia Airlines": "contact@croatiaairlines.hr",
  "Alitalia (ITA Airways)": "customer.relations@itaspa.com",
  "Condor": "service@condor.com"
};

const airlineLogos = {
  "Ryanair": "images/logos/ryanair.png",
  "easyJet": "images/logos/easyjet.png",
  "Lufthansa": "images/logos/lufthansa.png",
  "Vueling": "images/logos/vueling.png",
  "British Airways": "images/logos/britishairways.png",
  "KLM": "images/logos/klm.png",
  "Transavia": "images/logos/transavia.png",
  "Air France": "images/logos/airfrance.png",
  "Iberia": "images/logos/iberia.png",
  "Jet2": "images/logos/jet2.png",
  "Wizz Air": "images/logos/wizzair.png",
  "TUI Airways": "images/logos/tuiairways.png",
  "Norwegian": "images/logos/norwegian.png",
  "Aer Lingus": "images/logos/aerlingus.png",
  "Brussels Airlines": "images/logos/brusselsairlines.png",
  "Swiss International Air Lines": "images/logos/swissinternationalairlines.png",
  "Eurowings": "images/logos/eurowings.png",
  "TAP Air Portugal": "images/logos/tapairportugal.png",
  "Finnair": "images/logos/finnair.png",
  "SAS Scandinavian Airlines": "images/logos/sasscandinavianairlines.png",
  "Aegean Airlines": "images/logos/aegeanairlines.png",
  "LOT Polish Airlines": "images/logos/lotpolishairlines.png",
  "Air Malta": "images/logos/airmalta.png",
  "Corendon Airlines": "images/logos/corendonairlines.png",
  "SunExpress": "images/logos/sunexpress.png",
  "Blue Air": "images/logos/blueair.png",
  "Volotea": "images/logos/volotea.png",
  "Lauda Europe": "images/logos/laudaeurope.png",
  "Widerøe": "images/logos/wideroe.png",
  "Croatia Airlines": "images/logos/croatiaairlines.png",
  "Alitalia (ITA Airways)": "images/logos/italiaitaairways.png",
  "Condor": "images/logos/condor.png"
};

document.getElementById("airline").addEventListener("input", function () {
  const airlineName = this.value;
  const logoPath = airlineLogos[airlineName];
  const previewContainer = document.getElementById("airlineLogoPreview");
  if (logoPath) {
    previewContainer.innerHTML = `<img src="${logoPath}" alt="${airlineName} Logo" class="mx-auto h-12 md:h-16 mt-2">`;
  } else {
    previewContainer.innerHTML = "";
  }
});
</script>

<script>
  // ✅ UPDATED SCRIPT WITH BOOKING REF + IBAN FIELDS INCLUDED IN CLAIM DATA AND PDF
  document.getElementById("claim-letter-form").addEventListener("submit", async function (e) {
    e.preventDefault();

    const fullName = document.getElementById("fullName").value.trim();
    const flightNumber = document.getElementById("flightNumber").value.trim();
    const flightDate = document.getElementById("flightDate").value;
    const bookingRef = document.getElementById("bookingRef").value.trim();
    const iban = document.getElementById("iban").value.trim();
    const depAirport = document.getElementById("depAirport").value.trim();
    const arrAirport = document.getElementById("arrAirport").value.trim();
    const airline = document.getElementById("airline").value;
    const reason = document.getElementById("reason").value.trim();
    const language = document.getElementById("language").value;
    const email = document.getElementById("email").value.trim();
    const handleOption = document.getElementById("handleOption").value;
    const donation = document.getElementById("donation").value;
    const distance = document.getElementById("distance").value;
    const delayDuration = document.getElementById("delayDuration").value;
    const compensation = calculateCompensation(distance, delayDuration);

    if (!fullName || !flightNumber || !flightDate || !depAirport || !arrAirport || !email || !airline) {
      alert("Please fill in all required fields.");
      return;
    }

    const file = document.getElementById("fileUpload").files[0];
    let fileURL = "";

    if (file) {
      const storageRef = ref(storage, `uploads/${Date.now()}-${file.name}`);
      const uploadSnapshot = await uploadBytes(storageRef, file);
      fileURL = await getDownloadURL(uploadSnapshot.ref);
    }

    const claimData = {
      fullName,
      flightNumber,
      flightDate,
      depAirport,
      arrAirport,
      airline,
      reason,
      distance,
      delayDuration,
      compensation,
      language,
      email,
      handleOption,
      donation,
      bookingRef,
      iban,
      fileURL,
      createdAt: serverTimestamp(),
      airlineEmail: airlineEmails[airline] || ""
    };

    try {
      await addDoc(collection(db, "flightClaimLetters"), claimData);

      if (handleOption === "pdf") {
        generatePDF(claimData);
      } else if (handleOption === "email") {
        await fetch("https://us-central1-quaerensclaims.cloudfunctions.net/sendClaimEmail", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(claimData)
        });
        alert("✅ Your letter has been emailed!");
      } else if (handleOption === "quaerens") {
        alert("✅ Your case has been submitted to Quaerens. We’ll contact you shortly.");
      }

      document.getElementById("claim-letter-result").classList.remove("hidden");
    } catch (err) {
      console.error("Error saving claim:", err);
      alert("Something went wrong. Please try again.");
    }
  });
</script>

<script>
const translations = {
  en: {
    intro: `Dear Sir/Madam,\n\nI am writing to formally request compensation under EC Regulation 261/2004 for the following disrupted flight:`,
    closing: `According to EC Regulation 261/2004, I am entitled to this compensation based on the circumstances described above. Please process this claim within 14 days. I reserve the right to escalate to the relevant enforcement body or seek legal redress if not resolved in time.\n\nSincerely,\n\n`,
    subject: "Compensation Request under EC Regulation 261/2004",
    to: "To:",
    detailsTitle: "Flight Details:",
    paymentLabel: "Preferred Payment Method",
    claimRef: "Claim Reference",
    footer: "This document was generated at no cost by Quaerens.co.uk."
  },
  fr: {
    intro: `Madame, Monsieur,\n\nJe vous écris pour demander une indemnisation selon le règlement CE 261/2004 pour le vol suivant :`,
    closing: `Conformément au règlement CE 261/2004, j'ai droit à une indemnisation basée sur les circonstances décrites ci-dessus. Veuillez traiter cette réclamation dans les 14 jours. Je me réserve le droit de faire appel à l'organisme compétent ou de recourir à une procédure judiciaire si cela n'est pas résolu à temps.\n\nCordialement,\n\n`,
    subject: "Demande d'indemnisation selon le règlement CE 261/2004",
    to: "À :",
    detailsTitle: "Détails du vol :",
    paymentLabel: "Méthode de paiement préférée",
    claimRef: "Référence du dossier",
    footer: "Ce document a été généré gratuitement par Quaerens.co.uk."
  },
  // Add other languages here (de, es, nl)
};

function generatePDF(data) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const today = new Date().toLocaleDateString();
  const claimRef = `Q-${new Date().toISOString().slice(0, 10).replace(/-/g, "")}-${Math.random().toString(36).substring(2, 8).toUpperCase()}`;
  const airlineContact = `${data.airline}\n${data.airlineEmail ? "Email: " + data.airlineEmail : ""}`;
  const logoPath = airlineLogos[data.airline];

  function insertHeader() {
    if (logoPath) {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.src = logoPath;
      img.onload = () => {
        doc.addImage(img, "PNG", 150, 8, 40, 15);
        insertContent();
      };
      img.onerror = insertContent;
    } else {
      insertContent();
    }
  }

  function insertContent() {
    let y = 20;
    doc.setFont("helvetica", "normal");
    doc.setFontSize(12);
    doc.setTextColor(0, 0, 0);

    doc.setFont(undefined, "bold");
    doc.text(today, 10, y);
    y += 10;

    doc.setFont(undefined, "normal");
    doc.text(`Claim Reference: ${claimRef}`, 10, y);
    y += 12;

    doc.setFont(undefined, "bold");
    doc.text("To:", 10, y);
    y += 6;
    doc.setFont(undefined, "normal");
    doc.text(airlineContact, 10, y);
    y += 14;

    doc.setFont(undefined, "bold");
    doc.text("Subject:", 10, y);
    y += 6;
    doc.setFont(undefined, "normal");
    doc.text("Compensation Request under EC Regulation 261/2004", 10, y);
    y += 10;

    const intro = `Dear Sir/Madam,\n\nI am writing to formally request compensation under EC Regulation 261/2004 for the following disrupted flight:`;
    const introLines = doc.splitTextToSize(intro, 180);
    doc.text(introLines, 10, y);
    y += introLines.length * 6 + 6;

    doc.setFont(undefined, "bold");
    doc.text("Flight Details:", 10, y);
    y += 8;

    doc.setFont(undefined, "normal");
    const details = [
      `Passenger Name: ${data.fullName}`,
      `Email: ${data.email}`,
      `Flight Number: ${data.flightNumber}`,
      `Booking Reference: ${data.bookingRef}`,
      `Flight Date: ${data.flightDate}`,
      `Departure Airport: ${data.depAirport}`,
      `Arrival Airport: ${data.arrAirport}`,
      `Airline: ${data.airline}`,
      `Reason for Delay: ${data.reason || "Not specified"}`,
      `Flight Distance: ${data.distance}`,
      `Delay Duration: ${data.delayDuration}`,
      `Estimated Compensation: €${data.compensation}`,
      `Preferred Payment Method: ${data.iban}`
    ];
    details.forEach(line => {
      doc.text(line, 10, y);
      y += 7;
    });

    y += 4;
    const closing = `According to EC Regulation 261/2004, I am entitled to this compensation based on the circumstances described above. Please process this claim within 14 days. I reserve the right to escalate to the relevant enforcement body or seek legal redress if not resolved in time.\n\nSincerely,\n\n${data.fullName}`;
    const closingLines = doc.splitTextToSize(closing, 180);
    doc.text(closingLines, 10, y);
    y += closingLines.length * 6;

    doc.setFontSize(10);
    doc.setTextColor(120);
    doc.text("This document was generated at no cost by Quaerens.co.uk.", 10, 290);

    doc.save(`EC261-Claim-${data.flightNumber}.pdf`);
  }

  insertHeader();
}

</script>


  
</body>
</html>
