<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="images/favicon.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Energy Switch Compensation Claim | Quaerens</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .goog-te-banner-frame.skiptranslate, .goog-te-gadget-icon, .goog-logo-link, .goog-te-gadget, body > .skiptranslate {
      display: none !important;
    }
    .goog-te-gadget { font-size: 0 !important; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <div id="google_translate_element" style="display: none;"></div>
  <header class="bg-white shadow">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <a href="/"><img src="images/logo-energytemp.png" alt="Quaerens Logo" class="h-20 w-auto" /></a>
      <nav>
        <div class="w-full bg-gray-100 text-right p-2">
          <div x-data="{ open: false }" class="relative inline-block text-left">
            <button @click="open = !open"
              class="inline-flex items-center justify-center rounded border border-gray-300 px-4 py-2 bg-white text-sm font-medium text-gray-700 hover:bg-gray-100 focus:outline-none">
              🌐 Language
              <svg class="ml-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8l5 5 5-5" />
              </svg>
            </button>
            <div x-show="open" @click.outside="open = false"
              class="absolute right-0 mt-2 w-48 rounded-md shadow bg-white text-sm text-gray-700 z-50">
              <a href="#" onclick="setLanguage('en|en')" class="block px-4 py-2 hover:bg-gray-100">🇬🇧 English</a>
              <a href="#" onclick="setLanguage('en|fr')" class="block px-4 py-2 hover:bg-gray-100">🇫🇷 Français</a>
              <a href="#" onclick="setLanguage('en|es')" class="block px-4 py-2 hover:bg-gray-100">🇪🇸 Español</a>
              <a href="#" onclick="setLanguage('en|de')" class="block px-4 py-2 hover:bg-gray-100">🇩🇪 Deutsch</a>
              <a href="#" onclick="setLanguage('en|it')" class="block px-4 py-2 hover:bg-gray-100">🇮🇹 Italiano</a>
              <a href="#" onclick="setLanguage('en|nl')" class="block px-4 py-2 hover:bg-gray-100">🇳🇱 Nederlands</a>
            </div>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="relative w-full overflow-hidden">
    <img src="images/hero-energy2.png" alt="Energy Switch Claim Banner"
      class="w-full h-auto object-cover object-center" loading="eager" fetchpriority="high" />
  </section>

  <div class="max-w-3xl mx-auto px-4 mt-12 mb-8" data-aos="fade-up">
    <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-900 p-6 rounded-xl shadow text-left">
      <h3 class="text-lg font-bold mb-3">How This Works – It's 100% Free</h3>
      <ul class="space-y-3 text-sm sm:text-base">
        <li class="flex items-start gap-2"><span class="text-green-600 mt-1">✔</span>
          <span>Fill in your energy switch details; we’ll generate your claim letter <strong>completely FREE!</strong>.</span>
        </li>
        <li class="flex items-start gap-2"><span class="text-green-600 mt-1">✔</span>
          <span>Email or print the PDF we provide, then send it to your supplier. That’s all you need to do!</span>
        </li>
        <li class="flex items-start gap-2"><span class="text-green-600 mt-1">✔</span>
          <span>Just wait for your compensation—no commission, no hidden costs.</span>
        </li>
        <li class="flex items-start gap-2"><span class="text-green-600 mt-1">✔</span>
          <span>If you like our free service, please recommend us to your friends and family. 😊</span>
        </li>
      </ul>
    </div>

    <form id="claim-letter-form" class="space-y-6 mt-8 bg-white p-8 rounded-xl shadow" enctype="multipart/form-data" novalidate>
      <div>
        <label for="fullName" class="block text-sm font-semibold text-gray-700">Full Name *</label>
        <input type="text" id="fullName" name="fullName" required class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        <p class="text-xs text-gray-500 mt-1">Enter your name as it appears on your energy bill or account.</p>
      </div>
      <div>
        <label for="email" class="block text-sm font-semibold text-gray-700">Email Address *</label>
        <input type="email" id="email" name="email" required class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        <p class="text-xs text-gray-500 mt-1">We’ll send your claim PDF to this address.</p>
      </div>
      <div>
        <label for="phone" class="block text-sm font-semibold text-gray-700">Phone Number</label>
        <input type="tel" id="phone" name="phone" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        <p class="text-xs text-gray-500 mt-1">Optional, for urgent queries only.</p>
      </div>
      <div>
        <label for="accountRef" class="block text-sm font-semibold text-gray-700">Account Number / Reference</label>
        <input type="text" id="accountRef" name="accountRef" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        <p class="text-xs text-gray-500 mt-1">As shown on your bill or energy account.</p>
      </div>
      <div>
        <label for="supplier" class="block text-sm font-semibold text-gray-700">Energy Supplier *</label>
        <input type="text" id="supplier" name="supplier" required class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        <p class="text-xs text-gray-500 mt-1">E.g. Octopus, British Gas, E.ON, EDF, Scottish Power, etc.</p>
      </div>
      <div>
        <label for="switchDate" class="block text-sm font-semibold text-gray-700">Date You Signed Up / Requested Switch</label>
        <input type="date" id="switchDate" name="switchDate" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      </div>
      <div>
        <label for="originalSupplier" class="block text-sm font-semibold text-gray-700">Previous Supplier</label>
        <input type="text" id="originalSupplier" name="originalSupplier" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        <p class="text-xs text-gray-500 mt-1">If you were switching from another supplier.</p>
      </div>
      <div>
        <label for="claimType" class="block text-sm font-semibold text-gray-700">Type of Switch Problem *</label>
        <select id="claimType" name="claimType" required class="w-full border border-gray-300 rounded-md p-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="" disabled selected>Select problem type</option>
          <option value="delayed">Switch delayed (took longer than 5 working days)</option>
          <option value="erroneous">Erroneous switch (changed without permission)</option>
          <option value="finalbill">No final bill or refund</option>
          <option value="other">Other issue (describe below)</option>
        </select>
      </div>
      <div>
        <label for="issueDescription" class="block text-sm font-semibold text-gray-700">Describe the Issue *</label>
        <textarea id="issueDescription" name="issueDescription" rows="4" required class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"></textarea>
        <p class="text-xs text-gray-500 mt-1">Describe what happened, dates, switch timeline, and supplier responses.</p>
      </div>
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Tick the evidence you can provide:</label>
        <div class="flex flex-col gap-2 pl-1">
          <label><input type="checkbox" name="evidence" value="Account Bill" class="mr-2">Copy of Energy Bill / Account</label>
          <label><input type="checkbox" name="evidence" value="Switch Confirmation" class="mr-2">Switch Confirmation Email/Letter</label>
          <label><input type="checkbox" name="evidence" value="Complaint Email" class="mr-2">Complaint to Supplier</label>
          <label><input type="checkbox" name="evidence" value="Previous Supplier Correspondence" class="mr-2">Previous Supplier Correspondence</label>
          <label><input type="checkbox" name="evidence" value="Ombudsman Complaint" class="mr-2">Ombudsman Complaint</label>
          <label>
            <input type="checkbox" name="evidence" value="Other" class="mr-2" id="evidenceOtherCheckbox">
            Other relevant documents
          </label>
          <input type="text" id="evidenceOtherText" name="evidenceOtherText"
                 class="mt-2 p-2 border border-gray-300 rounded w-full text-sm"
                 placeholder="Please specify other evidence"
                 style="display:none;" />
        </div>
        <p class="text-xs text-gray-500 mt-2">Tick all that apply. You can upload these or mention if available on request.</p>
      </div>
      <div>
        <label for="compensationClaimed" class="block text-sm font-semibold text-gray-700">Compensation Claimed (£, if known)</label>
        <input type="number" min="0" step="0.01" id="compensationClaimed" name="compensationClaimed"
            class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        <p class="text-xs text-gray-500 mt-1">Usually £30 per fuel. Estimate if unsure.</p>
      </div>
      <div>
        <label for="preferredContact" class="block text-sm font-semibold text-gray-700">Preferred Contact Method</label>
        <select id="preferredContact" name="preferredContact" class="w-full border border-gray-300 rounded-md p-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="email">Email</option>
          <option value="phone">Phone</option>
        </select>
      </div>
      <div>
        <label for="donation" class="block text-sm font-semibold text-gray-700">Donation (optional)</label>
        <select id="donation" name="donation" class="w-full border border-gray-300 rounded-md p-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="0" selected>None</option>
          <option value="5">£5</option>
          <option value="10">£10</option>
          <option value="20">£20</option>
        </select>
      </div>
      <div class="text-center pt-4">
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition">
          Submit My Energy Claim
        </button>
      </div>
      <div id="claim-letter-result" class="hidden mt-6 text-green-700 font-semibold text-center">
        ✅ Your claim has been submitted. We’ll be in touch soon.
      </div>
    </form>
  </div>

  <footer class="bg-blue-900 text-white text-center py-6 w-full">
    <p class="mb-2">© 2025 Quaerens Ltd. All rights reserved.</p>
    <p>
      <a href="#" class="underline">Privacy Policy</a> |
      <a href="#" class="underline">Terms of Use</a> |
      <a href="#" class="underline">GDPR</a> |
      <a href="#" class="underline">Contact Us</a>
    </p>
  </footer>

  <script type="module" src="firebase-setup.js"></script>
  <script>
document.addEventListener('DOMContentLoaded', async () => {
  // Prefill fields from query params
  const params = new URLSearchParams(window.location.search);
  const prefillFields = [
    "claimType", "compensationClaimed", "fullName", "email", "phone",
    "accountRef", "supplier", "switchDate", "originalSupplier"
  ];
  prefillFields.forEach(f => {
    if (params.has(f)) {
      const el = document.getElementById(f);
      if (el) el.value = params.get(f);
    }
  });

  const form = document.getElementById("claim-letter-form");
  const resultDiv = document.getElementById("claim-letter-result");

  // LEGAL JUSTIFICATION for energy switch claims
  const legalJustification = {
    delayed: `Under Ofgem's Guaranteed Standards for Switching, you are entitled to compensation of £30 per fuel (gas/electric) if your switch was not completed within 5 working days of the request. The supplier must pay you directly within 10 working days of the missed deadline.`,
    erroneous: `Ofgem's Guaranteed Standards state that if you were switched to a new supplier by mistake or without your consent, you are entitled to compensation (usually £30–£60) and to be returned to your original supplier. The supplier must pay you directly.`,
    finalbill: `If you did not receive a final bill or refund from your old supplier within 6 weeks of your switch, you are entitled to compensation (£30 per fuel) under Ofgem's Guaranteed Standards.`,
    other: `As an energy customer in the UK, you are protected by Ofgem’s Guaranteed Standards and the right to fair, timely switching and billing. Suppliers must follow the rules or pay compensation directly.`
  };

  function generatePDF(data) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const today = new Date().toLocaleDateString();
    const claimRef = `EN-${new Date().toISOString().slice(0, 10).replace(/-/g, "")}-${Math.random().toString(36).substring(2, 8).toUpperCase()}`;
    const amount = data.compensationClaimed || 0;
    let y = 20;

    doc.setFont("helvetica", "normal").setFontSize(12).setTextColor(0, 0, 0);
    doc.setFont(undefined, "bold").text(today, 10, y); y += 10;
    doc.setFont(undefined, "normal").text(`Claim Reference: ${claimRef}`, 10, y); y += 10;
    doc.setFont(undefined, "bold").text("To:", 10, y); y += 6;
    doc.setFont(undefined, "normal").text(`${data.supplier || ""}`, 10, y); y += 14;
    doc.setFont(undefined, "bold").text("Subject:", 10, y); y += 6;
    doc.setFont(undefined, "normal").text("Energy Switch Compensation Claim – Ofgem Guaranteed Standards", 10, y); y += 12;
    doc.setFont(undefined, "normal").text("Dear Sir/Madam,", 10, y); y += 10;

    const reasonText = data.claimType ? document.querySelector(`#claimType option[value="${data.claimType}"]`).textContent : "N/A";
    const intro = `I am writing to formally request compensation for an energy switch problem: ${reasonText.toLowerCase()}. Please see details below.`;
    const introLines = doc.splitTextToSize(intro, 180);
    doc.text(introLines, 10, y); y += introLines.length * 6 + 2;

    const legalText = legalJustification[data.claimType] || legalJustification.other;
    const legalLines = doc.splitTextToSize(legalText, 180);
    doc.setFont(undefined, "italic");
    doc.text(legalLines, 10, y); y += legalLines.length * 6 + 4;
    doc.setFont(undefined, "normal");

    doc.setFont(undefined, "bold").text("Switch Details:", 10, y); y += 8;
    [
      `Full Name: ${data.fullName || ""}`,
      `Account Number: ${data.accountRef || ""}`,
      `Date Requested Switch: ${data.switchDate || ""}`,
      `Previous Supplier: ${data.originalSupplier || ""}`,
      `Current Supplier: ${data.supplier || ""}`,
      `Problem Type: ${reasonText}`,
      `Issue Description: ${data.issueDescription || ""}`
    ].forEach(line => { doc.text(line, 10, y); y += 7; });

    if (data.evidenceList && data.evidenceList.length > 0) {
      doc.setFont(undefined, "bold").text("Evidence Provided:", 10, y); y += 8;
      data.evidenceList.forEach(item => {
        doc.setFont(undefined, "normal").text("- " + item, 14, y); y += 7;
      });
      y += 2;
    }

    y += 2;
    doc.setFont(undefined, "bold").text("Compensation Claimed:", 10, y); y += 7;
    doc.setFont(undefined, "normal").text(`£${amount.toFixed(2)}`, 10, y); y += 10;

    doc.setFont(undefined, "bold").text("Preferred Contact Method:", 10, y); y += 7;
    doc.setFont(undefined, "normal").text(`${data.preferredContact || ""}`, 10, y); y += 10;

    const closing = `Please process this claim and arrange compensation within 10 working days of receipt. Please confirm receipt and your proposed resolution. Supporting documents can be provided as required.`;
    const closingLines = doc.splitTextToSize(closing, 180);
    doc.text(closingLines, 10, y); y += closingLines.length * 6 + 2;

    doc.text("Thank you for your attention.", 10, y); y += 8;
    doc.text("Yours faithfully,", 10, y); y += 8;
    doc.text(data.fullName || "", 10, y); y += 8;

    const pageHeight = doc.internal.pageSize.getHeight();
    doc.setFontSize(10).setTextColor(120).text(
      "This document was generated at no cost by Quaerens.co.uk.",
      10,
      pageHeight - 10
    );

    doc.save(`Energy-Switch-Claim-${data.accountRef || "unknown"}.pdf`);
  }

  function disableForm(form) {
    if (!form) return;
    [...form.elements].forEach(el => el.disabled = true);
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    resultDiv.classList.add("hidden");

    // Gather fields
    const fullName = document.getElementById("fullName").value.trim();
    const email = document.getElementById("email").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const accountRef = document.getElementById("accountRef").value.trim();
    const supplier = document.getElementById("supplier").value.trim();
    const switchDate = document.getElementById("switchDate").value;
    const originalSupplier = document.getElementById("originalSupplier").value.trim();
    const claimType = document.getElementById("claimType").value;
    const issueDescription = document.getElementById("issueDescription").value.trim();
    const compensationClaimed = parseFloat(document.getElementById("compensationClaimed").value) || 0;
    const preferredContact = document.getElementById("preferredContact").value;
    const donation = document.getElementById("donation").value;

    const evidenceEls = document.querySelectorAll('input[name="evidence"]:checked');
    const evidenceOtherText = document.getElementById('evidenceOtherText').value.trim();
    let evidenceList = Array.from(evidenceEls).map(el => el.value);
    if (evidenceList.includes("Other") && evidenceOtherText) {
      evidenceList[evidenceList.indexOf("Other")] = "Other: " + evidenceOtherText;
    }

    if (!fullName || !email || !supplier || !claimType || !issueDescription) {
      alert("Please fill in all required fields marked with *.");
      return;
    }

    const claimData = {
      fullName, email, phone, accountRef, supplier, switchDate, originalSupplier,
      claimType, issueDescription, compensationClaimed, preferredContact, donation, evidenceList,
      createdAt: window.firebaseUtils ? serverTimestamp() : new Date().toISOString()
    };

    try {
      if (window.firebaseUtils && window.firebaseUtils.collection) await addDoc(collection(window.db, "energyClaims"), claimData);

      generatePDF(claimData);
      disableForm(form);
      let msg = "✅ Your claim letter has been generated as a PDF. Please send it to your energy supplier.<br><br>";
      if (evidenceList.length > 0) {
        msg += "<strong>Evidence you indicated:</strong><ul style='margin-left:1em'>";
        evidenceList.forEach(ev => msg += "<li>" + ev + "</li>");
        msg += "</ul><br>";
      }
      msg += "<strong>How to use your claim letter:</strong><ol style='margin-left:1em'><li>Download and review your letter</li><li>Attach your evidence documents</li><li>Email or post your letter and evidence to your supplier’s complaints team</li><li>Wait for a response (usually 1–2 weeks)</li></ol>";
      resultDiv.innerHTML = msg;
      resultDiv.classList.remove("hidden");

    } catch (err) {
      alert("Something went wrong while submitting your claim. Please try again or contact support.");
    }
  });
});
</script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const otherCheckbox = document.getElementById('evidenceOtherCheckbox');
      const otherText = document.getElementById('evidenceOtherText');
      if (otherCheckbox) {
        otherCheckbox.addEventListener('change', function() {
          otherText.style.display = this.checked ? '' : 'none';
          if (!this.checked) otherText.value = '';
        });
      }
    });
  </script>
</body>
</html>