<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="images/favicon.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Train Delay Compensation Claim | Quaerens</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    /* Hide Google Translate top banner and branding */
    .goog-te-banner-frame.skiptranslate,
    .goog-te-gadget-icon,
    .goog-logo-link,
    .goog-te-gadget,
    body > .skiptranslate {
      display: none !important;
    }
    .goog-te-gadget { font-size: 0 !important; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

<!-- Header -->
<header class="bg-white shadow">
  <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
    <a href="/">
      <img src="images/quaerens-logo.png" alt="Quaerens Logo" class="h-20 w-auto" />
    </a>
    <nav>
      <a href="/" class="text-blue-700 hover:underline font-semibold">Home</a>
    </nav>
  </div>
</header>

<!-- Main Explainer Box + Form -->
<div class="max-w-3xl mx-auto px-4 mt-10 mb-8">
  <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-900 p-6 rounded-xl shadow text-left">
    <h3 class="text-lg font-bold mb-3">How This Works â€“ It's 100% Free</h3>
    <ul class="space-y-3 text-sm sm:text-base">
      <li class="flex items-start gap-2">
        <span class="text-green-600 mt-1">âœ”</span>
        <span>Fill in your train journey and compensation details; weâ€™ll generate your claim letter <strong>completely FREE!</strong>.</span>
      </li>
      <li class="flex items-start gap-2">
        <span class="text-green-600 mt-1">âœ”</span>
        <span>Email or print the PDF and send it to the rail operator â€“ thatâ€™s all you need to do!</span>
      </li>
      <li class="flex items-start gap-2">
        <span class="text-green-600 mt-1">âœ”</span>
        <span>No hidden costs. If you like our free service, please recommend us. ðŸ˜Š</span>
      </li>
    </ul>
  </div>

  <!-- Claim Form Box -->
  <form id="claim-letter-form" class="space-y-6 mt-8 bg-white p-8 rounded-xl shadow" enctype="multipart/form-data" novalidate>
    <div>
      <label for="fullName" class="block text-sm font-semibold text-gray-700">Full Name *</label>
      <input type="text" id="fullName" name="fullName" required class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500" />
    </div>
    <div>
      <label for="email" class="block text-sm font-semibold text-gray-700">Email Address *</label>
      <input type="email" id="email" name="email" required class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500" />
    </div>
    <div>
      <label for="phone" class="block text-sm font-semibold text-gray-700">Phone Number</label>
      <input type="tel" id="phone" name="phone" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500" />
    </div>
    <div>
      <label for="operator" class="block text-sm font-semibold text-gray-700">Train Operator *</label>
      <input type="text" id="operator" name="operator" required class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500" placeholder="E.g. LNER, Eurostar, SNCF" />
    </div>
    <div>
      <label for="journey" class="block text-sm font-semibold text-gray-700">Journey *</label>
      <input type="text" id="journey" name="journey" required class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500" placeholder="E.g. London to Paris" />
    </div>
    <div>
      <label for="travelDate" class="block text-sm font-semibold text-gray-700">Date of Travel *</label>
      <input type="date" id="travelDate" name="travelDate" required class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500" />
    </div>
    <div>
      <label for="scheduledTime" class="block text-sm font-semibold text-gray-700">Scheduled Departure Time *</label>
      <input type="time" id="scheduledTime" name="scheduledTime" required class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500" />
    </div>
    <div>
      <label for="delayMinutes" class="block text-sm font-semibold text-gray-700">Delay Duration (Minutes) *</label>
      <input type="number" min="1" id="delayMinutes" name="delayMinutes" required class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500" />
    </div>
    <div>
      <label for="ticketPrice" class="block text-sm font-semibold text-gray-700">Ticket Price (â‚¬ or Â£) *</label>
      <input type="number" min="1" id="ticketPrice" name="ticketPrice" required class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500" />
    </div>
    <div>
      <label for="compensationClaimed" class="block text-sm font-semibold text-gray-700">Amount Claimed (â‚¬)</label>
      <input type="number" min="0" step="0.01" id="compensationClaimed" name="compensationClaimed" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500" />
      <p class="text-xs text-gray-500 mt-1">Prefilled based on calculator. Edit if you need to claim a different amount.</p>
    </div>
    <div>
      <label for="issueDescription" class="block text-sm font-semibold text-gray-700">What Happened? *</label>
      <textarea id="issueDescription" name="issueDescription" rows="3" required class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 resize-none"></textarea>
      <p class="text-xs text-gray-500 mt-1">Briefly explain the delay or disruption.</p>
    </div>
    <!-- Evidence Checklist -->
    <div>
      <label class="block text-sm font-semibold text-gray-700 mb-2">Evidence You Can Provide:</label>
      <div class="flex flex-col gap-2 pl-1">
        <label><input type="checkbox" name="evidence" value="Ticket/Booking Confirmation" class="mr-2">Ticket/Booking Confirmation</label>
        <label><input type="checkbox" name="evidence" value="Proof of Payment" class="mr-2">Proof of Payment</label>
        <label><input type="checkbox" name="evidence" value="Delay Notification" class="mr-2">Delay Notification (App/SMS/Email)</label>
        <label><input type="checkbox" name="evidence" value="Photos of Delay Board" class="mr-2">Photos of Delay Board</label>
        <label><input type="checkbox" name="evidence" value="Correspondence with Operator" class="mr-2">Correspondence with Operator</label>
        <label><input type="checkbox" name="evidence" value="Other" class="mr-2" id="evidenceOtherCheckbox">Other relevant documents</label>
        <input type="text" id="evidenceOtherText" name="evidenceOtherText" class="mt-2 p-2 border border-gray-300 rounded w-full text-sm" placeholder="Please specify other evidence" style="display:none;" />
      </div>
      <p class="text-xs text-gray-500 mt-2">Tick all that apply. You can upload these or mention if available on request.</p>
    </div>
    <!-- Submit Button -->
    <div class="text-center pt-4">
      <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition">
        Generate My Free Claim Letter
      </button>
    </div>
    <div id="claim-letter-result" class="hidden mt-6 text-green-700 font-semibold text-center"></div>
  </form>
</div>

<!-- Prefill fields from query params -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const prefillFields = [
    "compensationClaimed", "fullName", "email", "phone", "operator", "journey", "travelDate", "delayMinutes", "ticketPrice"
  ];
  prefillFields.forEach(f => {
    if (params.has(f)) {
      const el = document.getElementById(f);
      if (el) el.value = params.get(f);
    }
  });
  // Show/hide 'Other evidence' text field
  const otherCheckbox = document.getElementById('evidenceOtherCheckbox');
  const otherText = document.getElementById('evidenceOtherText');
  if (otherCheckbox) {
    otherCheckbox.addEventListener('change', function () {
      otherText.style.display = this.checked ? '' : 'none';
      if (!this.checked) otherText.value = '';
    });
  }
});
</script>

<!-- PDF GENERATOR -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const form = document.getElementById("claim-letter-form");
  const resultDiv = document.getElementById("claim-letter-result");

  function generatePDF(data) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    let y = 20;
    const today = new Date().toLocaleDateString();
    const claimRef = `TR-${new Date().toISOString().slice(0, 10).replace(/-/g, "")}-${Math.random().toString(36).substring(2, 8).toUpperCase()}`;
    const amount = data.compensationClaimed || 0;

    doc.setFont("helvetica", "normal").setFontSize(12).setTextColor(0, 0, 0);
    doc.setFont(undefined, "bold").text(today, 10, y); y += 10;
    doc.setFont(undefined, "normal").text(`Claim Reference: ${claimRef}`, 10, y); y += 10;
    doc.setFont(undefined, "bold").text("To:", 10, y); y += 6;
    doc.setFont(undefined, "normal").text(`${data.operator || ""}`, 10, y); y += 14;
    doc.setFont(undefined, "bold").text("Subject:", 10, y); y += 6;
    doc.setFont(undefined, "normal").text("Train Delay Compensation Claim", 10, y); y += 12;
    doc.setFont(undefined, "normal").text("Dear Sir/Madam,", 10, y); y += 10;

    // LEGAL EXPLANATION
    const intro = `I am writing to request compensation for a train delay in accordance with ${
      data.region === "uk"
        ? "the UK Delay Repay scheme"
        : "EU Regulation 1371/2007"
    }. My journey details and the basis for my claim are provided below.`;
    const introLines = doc.splitTextToSize(intro, 180);
    doc.text(introLines, 10, y); y += introLines.length * 6 + 2;

    // Details
    doc.setFont(undefined, "bold").text("Journey Details:", 10, y); y += 8;
    [
      `Full Name: ${data.fullName || ""}`,
      `Train Operator: ${data.operator || ""}`,
      `Journey: ${data.journey || ""}`,
      `Date of Travel: ${data.travelDate || ""}`,
      `Scheduled Departure: ${data.scheduledTime || ""}`,
      `Delay Duration: ${data.delayMinutes || ""} minutes`,
      `Ticket Price: â‚¬${data.ticketPrice || ""}`,
      `Amount Claimed: â‚¬${amount}`
    ].forEach(line => { doc.setFont(undefined, "normal").text(line, 10, y); y += 7; });

    if (data.issueDescription) {
      doc.setFont(undefined, "bold").text("What happened:", 10, y); y += 7;
      const issueLines = doc.splitTextToSize(data.issueDescription, 180);
      doc.setFont(undefined, "normal").text(issueLines, 10, y); y += issueLines.length * 6 + 2;
    }

    // Evidence section
    if (data.evidenceList && data.evidenceList.length > 0) {
      doc.setFont(undefined, "bold").text("Included/Available Evidence:", 10, y); y += 8;
      data.evidenceList.forEach(item => {
        doc.setFont(undefined, "normal").text("- " + item, 14, y); y += 7;
      });
      y += 2;
    }

    // Legal basis block
    y += 4;
    doc.setFont(undefined, "bold").text("Legal Basis:", 10, y); y += 7;
    const legalText = data.region === "uk"
      ? "UK: Delay Repay â€“ You are entitled to compensation of up to 100% of the ticket price depending on delay length."
      : "EU: Regulation 1371/2007 â€“ You are entitled to 25% (60â€“119 min) or 50% (120+ min) of the ticket price for eligible delays.";
    const legalLines = doc.splitTextToSize(legalText, 180);
    doc.setFont(undefined, "italic").text(legalLines, 10, y); y += legalLines.length * 6 + 4;
    doc.setFont(undefined, "normal");

    // Footer
    const pageHeight = doc.internal.pageSize.getHeight();
    doc.setFontSize(10).setTextColor(120).text(
      "This document was generated at no cost by Quaerens.co.uk.",
      10,
      pageHeight - 10
    );

    doc.save(`Train-Delay-Claim-${claimRef}.pdf`);
  }

  // Form submit
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    resultDiv.classList.add("hidden");

    // Gather fields
    const data = {
      fullName: document.getElementById("fullName").value.trim(),
      email: document.getElementById("email").value.trim(),
      phone: document.getElementById("phone").value.trim(),
      operator: document.getElementById("operator").value.trim(),
      journey: document.getElementById("journey").value.trim(),
      travelDate: document.getElementById("travelDate").value,
      scheduledTime: document.getElementById("scheduledTime").value,
      delayMinutes: document.getElementById("delayMinutes").value,
      ticketPrice: document.getElementById("ticketPrice").value,
      compensationClaimed: parseFloat(document.getElementById("compensationClaimed").value) || 0,
      issueDescription: document.getElementById("issueDescription").value.trim(),
      region: "eu", // default, can set dynamically if you add region field
      evidenceList: (() => {
        const checked = document.querySelectorAll('input[name="evidence"]:checked');
        const otherText = document.getElementById('evidenceOtherText').value.trim();
        let out = Array.from(checked).map(el => el.value);
        if (out.includes("Other") && otherText) {
          out[out.indexOf("Other")] = "Other: " + otherText;
        }
        return out;
      })()
    };

    // TODO: Save to Firebase if you want â€“ add code here

    // Generate PDF
    generatePDF(data);

    // Confirmation message
    let msg = "âœ… Your claim letter has been generated as a PDF. Please send it to your train operator.<br><br>";
    if (data.evidenceList.length > 0) {
      msg += "<strong>Evidence you indicated:</strong><ul style='margin-left:1em'>";
      data.evidenceList.forEach(ev => msg += "<li>" + ev + "</li>");
      msg += "</ul><br>";
    }
    msg += "<strong>How to use your claim letter:</strong><ol style='margin-left:1em'><li>Download and review your letter</li><li>Attach your evidence documents</li><li>Email or post your letter and evidence to the operatorâ€™s claims department</li><li>Wait for a response (usually 2â€“4 weeks)</li></ol>";
    resultDiv.innerHTML = msg;
    resultDiv.classList.remove("hidden");
  });
});
</script>
</body>
</html>